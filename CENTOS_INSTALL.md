# Install

## CentOS 7

### Build Dependencies 

yum install -y epel-release
yum update -y
yum groupinstall -y "Development Tools"
yum install -y bind-utils network-tools pwgen p7zip tcsh vim-enhanced screen telnet  \
            wget pth pth-devel gdbm-devel gdbm dbi zlib-devel asciidoc pkgconfig  \
            python34 python34-setuptools perl-DBD-mysql
easy_install-3.4 pip

### Ninja

cd /usr/src
git clone git://github.com/ninja-build/ninja.git
cd ninja 
git checkout release
./configure.py --bootstrap
./ninja rpm
rpm -i <insert ninja RPM filename here>

Verify: `ninja`

### Meson

pip3 install meson

Verify: `meson`

### Install MariaDB

cat << EOT >> /etc/yum.repos.d/MariaDB.repo
[mariadb]
name = MariaDB
baseurl = http://yum.mariadb.org/10.1/centos7-amd64
gpgkey = https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
gpgcheck = 1
EOT

yum update -y
yum install MariaDB-server MariaDB-client MariaDB-devel -y
systemctl enable mariadb
systemctl start mariadb
mysql_secure_installation

Note: Be sure to remember the root password for MariaDB. This will be needed
for configuring the server after building.

vi /etc/my.cnf.d/server.cnf

Uncomment the line bind-address=0.0.0.0
Below it add skip-name-resolve

[mariadb]
...
bind-address=0.0.0.0
skip-name-resolve
...

Restart MariaDB

systemctl restart mariadb

### Clone Repository & Build

For security it is best to build and run server as a regular user. The 
development environment user is 'uldev'. The test and production servers use 
'ulprod'. The instructions following assume cloning and building will be done 
from the current user home directory.

git clone ssh://git@ulgit.koiware.com:423/KoiWare/ulserver.git
cd $HOME/ulserver/build
meson ..
ninja

### Install Server

cd $HOME/ulserver/build/scripts
./install.sh

Follow the prompts for entering the root password and IP address assignment.

### Load Level Files

Copy the server level files generated by the level editor to $HOME/lyra/src

cd $HOME/lyra/src
make level

### Start Server

cd $HOME/lyra/bin
./ulctl start

### Shutdown Server

cd $HOME/lyra/bin
./ulctl stop
